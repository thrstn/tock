tock=window.tock||{},tock.export={},tock.export.toCSV=function(){for(var t=tock.storage.getItem("layout").entries,e="",a=0;a<t.length;a++){var n="",i=t[a].elapsed,o=t[a].task,r=t[a].log;n+='"'+tock.ui.formatTimeJira(i)+'",',n+='"'+tock.ui.formatTimeDP(i)+'",',n+='"'+o+'",',n+='"'+r+'",',n.slice(0,n.length-1),e+=n+"\r\n"}if(""===e)return alert("Invalid data"),void console.log(e);var c="export",s="data:text/csv;charset=utf-8,"+encodeURIComponent(e),u=document.createElement("a");u.href=s,u.style="visibility:hidden",u.download=c+".csv",document.body.appendChild(u),u.click(),document.body.removeChild(u)},tock=window.tock||{},tock.storage={},tock.storage.init=function(){tock.storage.getItem("layout")||tock.storage.initDefaultLayout()},tock.storage.setItem=function(t,e){return"object"==typeof e&&(e=JSON.stringify(e)),localStorage.setItem(t,e)},tock.storage.getItem=function(t){var e=localStorage.getItem(t);try{e=JSON.parse(e)}catch(a){}return e},tock.storage.initDefaultLayout=function(){var t={entries:[{id:tock.generateId(),task:"ViÃ°vera",log:"",running:!1,elapsed:0},{id:tock.generateId(),task:"Matur",log:"",running:!1,elapsed:0},{id:tock.generateId(),task:"",log:"",running:!1,elapsed:0},{id:tock.generateId(),task:"",log:"",running:!1,elapsed:0}]};tock.storage.setItem("layout",t)},tock=window.tock||{},tock.timer={},tock.timer.init=function(){tock.timer.timeout=null,tock.timer.tick()},tock.timer.start=function(t){var e=$(t).parents(".entry");e.data("tock-timer-running")===!0?tock.timer.stop(t):(e.data("tock-timer-running",!0),e.data("tock-timer-elapsed")?e.data("tock-timer-start",Math.ceil(Date.now()/1e3-e.data("tock-timer-elapsed"))):e.data("tock-timer-start",Math.ceil(Date.now()/1e3)),tock.ui.timerButtonSwap(t))},tock.timer.stop=function(t){var e=$(t).parents(".entry");e.data("tock-timer-running")===!0&&(e.data("tock-timer-running",!1).data("tock-timer-start",null),tock.ui.timerButtonSwap(t))},tock.timer.reset=function(t){var e=$(t).parents(".entry");e.data("tock-timer-running",!1).data("tock-timer-elapsed",null).data("tock-timer-start",null),tock.ui.timerButtonSwap(e.find(".toggle .btn"))},tock.timer.tick=function(){tock.ui.updateElapsed(),Math.ceil(Date.now()/1e3)%5===1&&tock.ui.saveLayout(),tock.timer.timeout=setTimeout(tock.timer.tick,1e3)},tock=window.tock||{},tock.generateId=function(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var a=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?a:3&a|8).toString(16)});return e},tock.init=function(){tock.storage.init(),tock.ui.init(),tock.timer.init()},tock=window.tock||{},tock.ui={},tock.ui.init=function(){tock.ui.bind(),tock.ui.renderLayout()},tock.ui.bind=function(){$("body").on("click",".btn-start-timer",function(t){t.preventDefault(),tock.timer.start(this)}).on("click",".btn-stop-timer",function(t){t.preventDefault(),tock.timer.stop(this)}).on("click",".btn-reset-timer",function(t){t.preventDefault(),tock.timer.reset(this)}).on("click",".btn-add-entry",function(t){t.preventDefault(),tock.ui.createEntry(),tock.ui.saveLayout()}).on("click",".btn-del-entry",function(t){t.preventDefault(),tock.ui.deleteEntry(this),tock.ui.saveLayout()}).on("focus","input[type=text]",function(){$(this).addClass("focused")}).on("blur","input[type=text]",function(){$(this).removeClass("focused"),tock.ui.saveLayout()}).on("keyup","input[type=text]",function(t){(13==t.which||27==t.which)&&$(this).trigger("blur")}).on("click",".btn-export",function(t){t.preventDefault(),tock.export.toCSV()}).on("click",".btn-reset-layout",function(t){t.preventDefault(),tock.ui.resetLayout()}).on("click",".btn-reset-timers",function(t){t.preventDefault(),tock.ui.resetTimers()})},tock.ui.renderLayout=function(){var t=tock.storage.getItem("layout");$(t.entries).each(function(t,e){var a=tock.ui.cloneTemplate().attr("id",e.id);a.find(".task input").val(e.task),a.find(".log input").val(e.log),e.elapsed&&(a.data("tock-timer-elapsed",parseInt(e.elapsed)),tock.ui.timerButtonSwap(a.find(".btn-start-timer"))),e.running&&(a.data("tock-timer-running",e.running),tock.ui.timerButtonSwap(a.find(".btn-start-timer"))),tock.ui.addEntry(a)})},tock.ui.saveLayout=function(){var t={entries:[]};$(".entry").each(function(){var e=$(this),a={id:e.attr("id"),task:e.find(".task input").val(),log:e.find(".log input").val(),running:e.data("tock-timer-running"),elapsed:e.data("tock-timer-elapsed")};t.entries.push(a)}),tock.storage.setItem("layout",t)},tock.ui.resetLayout=function(){tock.storage.initDefaultLayout(),tock.ui.refresh()},tock.ui.resetTimers=function(){$(".btn-reset-timer").each(function(){tock.timer.reset(this)})},tock.ui.updateElapsed=function(){$(".entry").each(function(){var t=$(this),e=t.data("tock-timer-start"),a=t.data("tock-timer-elapsed"),n=a;t.data("tock-timer-running")===!0&&(e?(a=Math.ceil(Date.now()/1e3),n=Math.ceil(a-e),t.data("tock-timer-elapsed",n)):(e=Math.ceil(Date.now()/1e3)-a,t.data("tock-timer-start",e))),n>0?(t.find(".elapsed .jira").html(tock.ui.formatTimeJira(n)),t.find(".elapsed .dp").html(tock.ui.formatTimeDP(n))):(t.find(".elapsed .jira").html(""),t.find(".elapsed .dp").html(""))})},tock.ui.formatTimeJira=function(t){if(t){var e=Math.floor(t/3600),a=Math.floor(t%3600/60),n="";return e>0&&(n=e+"H "),n+a+"m"}return"0m"},tock.ui.formatTimeDP=function(t){return t?(t/3600).toFixed(2):"0.0"},tock.ui.timerButtonSwap=function(t){var e=$(t),a=e.parents(".entry");a.data("tock-timer-running")?e.hasClass("btn-start-timer")?e.removeClass("btn-start-timer btn-success btn-warning").addClass("btn-stop-timer btn-danger").attr("title","Pause this timer").html('<span class="fa-stack"><i class="fa fa-cog fa-spin fa-stack-2x"></i><i class="fa fa-pause fa-stack-1x"></i></span>'):e.removeClass("btn-stop-timer btn-danger").addClass("btn-start-timer btn-success").attr("title","Start this timer").html('<span class="fa-stack"><i class="fa fa-cog fa-stack-2x"></i><i class="fa fa-play fa-stack-1x"></i></span>'):a.data("tock-timer-elapsed")?e.removeClass("btn-stop-timer btn-danger").addClass("btn-start-timer btn-warning").attr("title","Start this timer").html('<span class="fa-stack"><i class="fa fa-cog fa-stack-2x"></i><i class="fa fa-play fa-stack-1x"></i></span>'):e.removeClass("btn-stop-timer btn-danger").addClass("btn-start-timer btn-success").attr("title","Start this timer").html('<span class="fa-stack"><i class="fa fa-cog fa-stack-2x"></i><i class="fa fa-play fa-stack-1x"></i></span>')},tock.ui.cloneTemplate=function(){return tock.ui.getTemplateEntry().clone().removeClass("template hidden").addClass("entry")},tock.ui.createEntry=function(){tock.ui.addEntry(tock.ui.cloneTemplate())},tock.ui.addEntry=function(t){$(".controls","main").before(t)},tock.ui.deleteEntry=function(t){var e=$(t).parents(".entry");e.remove()},tock.ui.getTemplateEntry=function(){return $(".template")},tock.ui.refresh=function(){window.location=""};
//# sourceMappingURL=tock.min.js.map