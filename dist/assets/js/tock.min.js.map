{"version":3,"sources":["tock.min.js"],"names":["tock","window","toCSV","data","storage","getItem","entries","csv","i","length","row","elapsed","task","log","ui","formatTimeJira","formatTimeDP","slice","alert","console","fileName","uri","encodeURIComponent","link","document","createElement","href","style","download","body","appendChild","click","removeChild","init","initDefaultLayout","setItem","key","value","JSON","stringify","localStorage","parse","e","layout","id","generateId","running","timer","timeout","tick","start","button","$entry","$","parents","stop","$elapsedInput","find","val","formatJiraTime","Math","ceil","Date","now","timerButtonSwap","reset","html","updateElapsed","saveLayout","setTimeout","d","getTime","uuid","replace","c","r","random","floor","toString","bind","renderLayout","on","preventDefault","this","createEntry","deleteEntry","addClass","removeClass","which","trigger","resetLayout","resetTimers","each","k","v","cloneTemplate","attr","parseInt","addEntry","push","refresh","diff","hasClass","removeAttr","h","m","string","match","ts","hours","minutes","toFixed","$button","timerButtonSwapToRunning","timerButtonSwapToStart","timerButtonSwapToPaused","getTemplateEntry","clone","entry","before","element","remove","location"],"mappings":"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","file":"tock.min.js","sourcesContent":["// Create objects\ntock = window.tock || {};\ntock.export = {};\n\ntock.export.toCSV = function() {\n\tvar data = tock.storage.getItem('layout').entries,\n\t\tcsv = '';\n\n\t//loop is to extract each row\n\tfor (var i = 0; i < data.length; i++) {\n\t\tvar row = \"\",\n\t\t\telapsed = data[i].elapsed,\n\t\t\ttask = data[i].task,\n\t\t\tlog = data[i].log;\n\n\t\trow += '\"' + tock.ui.formatTimeJira(elapsed) + '\",';\n\t\trow += '\"' + tock.ui.formatTimeDP(elapsed) + '\",';\n\t\trow += '\"' + task + '\",';\n\t\trow += '\"' + log + '\",';\n\n\t\trow.slice(0, row.length - 1);\n\n\t\t//add a line break after each row\n\t\tcsv += row + '\\r\\n';\n\t}\n\n\tif (csv === '') {\n\t\talert(\"Invalid data\");\n\t\tconsole.log(csv);\n\t\treturn;\n\t}\n\n\t//Generate a file name\n\tvar fileName = \"export\";\n\n\t//Initialize file format you want csv or xls\n\tvar uri = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);\n\n\t// Now the little tricky part.\n\t// you can use either>> window.open(uri);\n\t// but this will not work in some browsers\n\t// or you will not get the correct file extension\n\n\t//this trick will generate a temp <a /> tag\n\tvar link = document.createElement(\"a\");\n\tlink.href = uri;\n\n\t//set the visibility hidden so it will not effect on your web-layout\n\tlink.style = \"visibility:hidden\";\n\tlink.download = fileName + \".csv\";\n\n\t//this part will append the anchor tag and remove it after automatic click\n\tdocument.body.appendChild(link);\n\tlink.click();\n\tdocument.body.removeChild(link);\n};\n\n// Create objects\ntock = window.tock || {};\ntock.storage = {};\n\n// Storage\ntock.storage.init = function () {\n\tif (!tock.storage.getItem('layout')) {\n\t\ttock.storage.initDefaultLayout();\n\t}\n};\n\n// Set item value in localStorage\ntock.storage.setItem = function (key, value) {\n\tif (typeof value === 'object') {\n\t\tvalue = JSON.stringify(value);\n\t}\n\n\treturn localStorage.setItem(key, value);\n};\n\n// Get item value from localStorage\ntock.storage.getItem = function (key) {\n\tvar value = localStorage.getItem(key);\n\n\ttry {\n\t\tvalue = JSON.parse(value);\n\t} catch (e) {\n\t\t// We don't need to do anything. The value is not JSON.\n\t}\n\n\treturn value;\n};\n\ntock.storage.initDefaultLayout = function () {\n\tvar layout = {\n\t\t\"entries\": [\n\t\t\t{\n\t\t\t\t\"id\": tock.generateId(),\n\t\t\t\t\"task\": \"All day\",\n\t\t\t\t\"log\": \"You start this timer when you start working and leave it running all day.\",\n\t\t\t\t\"running\": false,\n\t\t\t\t\"elapsed\": 0\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": tock.generateId(),\n\t\t\t\t\"task\": 'Lunch',\n\t\t\t\t\"log\": \"Start when you grab some lunch.\",\n\t\t\t\t\"running\": false,\n\t\t\t\t\"elapsed\": 0\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": tock.generateId(),\n\t\t\t\t\"task\": '',\n\t\t\t\t\"log\": \"\",\n\t\t\t\t\"running\": false,\n\t\t\t\t\"elapsed\": 0\n\t\t\t}\n\t\t]\n\t};\n\n\ttock.storage.setItem('layout', layout);\n};\n\n// Create objects\ntock = window.tock || {};\ntock.timer = {};\n\n// Timer\ntock.timer.init = function () {\n\ttock.timer.timeout = null;\n\ttock.timer.tick();\n};\n\ntock.timer.start = function (button) {\n\tvar $entry = $(button).parents('.entry');\n\n\tif ($entry.data('tock-timer-running') === true) {\n\t\ttock.timer.stop(button);\n\t}\n\telse {\n\t\t$entry.data('tock-timer-running', true);\n\t\tvar $elapsedInput = $entry.find('.elapsed .jira');\n\n\t\t// We have a value in the timer box. Let's use that for the elapsed time\n\t\tif ($elapsedInput.val() !== '') {\n\t\t\t$entry.data('tock-timer-elapsed', tock.ui.formatJiraTime($elapsedInput.val()));\n\t\t}\n\n\t\t// Generate start time. Set it to now if we have no elapsed time\n        if ($entry.data('tock-timer-elapsed')) {\n            $entry.data('tock-timer-start', Math.ceil((Date.now() / 1000) - $entry.data('tock-timer-elapsed')));\n        }\n        else {\n            $entry.data('tock-timer-start', Math.ceil(Date.now() / 1000));\n        }\n\t\ttock.ui.timerButtonSwap(button);\n\t}\n};\n\ntock.timer.stop = function (button) {\n\tvar $entry = $(button).parents('.entry');\n\n\tif ($entry.data('tock-timer-running') === true) {\n\t\t$entry.data('tock-timer-running', false)\n\t\t\t.data('tock-timer-start', null);\n\n\t\ttock.ui.timerButtonSwap(button);\n\t}\n};\n\ntock.timer.reset = function (button) {\n\tvar $entry = $(button).parents('.entry');\n\n\t$entry.data('tock-timer-running', false)\n\t\t.data('tock-timer-elapsed', null)\n\t\t.data('tock-timer-start', null);\n\n\t// Update ui\n\t$entry.find('.elapsed .jira').val('');\n\t$entry.find('.elapsed .dp').html('');\n\n\ttock.ui.timerButtonSwap($entry.find('.toggle .btn'));\n};\n\ntock.timer.tick = function () {\n\ttock.ui.updateElapsed();\n\n\t// Autosave layout every 5 seconds\n\tif (Math.ceil(Date.now() / 1000) % 5 === 1) {\n\t\ttock.ui.saveLayout();\n\t}\n\ttock.timer.timeout = setTimeout(tock.timer.tick, 1000);\n};\n\n// Create objects\ntock = window.tock || {};\n\ntock.generateId = function () {\n\tvar d = new Date().getTime();\n\tvar uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n\t\tvar r = (d + Math.random()*16)%16 | 0;\n\t\td = Math.floor(d/16);\n\t\treturn (c=='x' ? r : (r&0x3|0x8)).toString(16);\n\t});\n\treturn uuid;\n};\n\n\n// Init everything\ntock.init = function () {\n\ttock.storage.init();\n\ttock.ui.init();\n\ttock.timer.init();\n};\n// Create objects\ntock = window.tock || {};\ntock.ui = {};\n\n// UI\ntock.ui.init = function() {\n\ttock.ui.bind();\n\ttock.ui.renderLayout();\n};\n\ntock.ui.bind = function() {\n\t$('body')\n\t\t.on('click', '.btn-start-timer', function(e) {\n\t\t\t// Start the timer for selected entry\n\t\t\te.preventDefault();\n\t\t\ttock.timer.start(this);\n\t\t})\n\t\t.on('click', '.btn-stop-timer', function(e) {\n\t\t\t// Stop the timer for selected entry\n\t\t\te.preventDefault();\n\t\t\ttock.timer.stop(this);\n\t\t})\n\t\t.on('click', '.btn-reset-timer', function(e) {\n\t\t\t// Stop the timer for selected entry\n\t\t\te.preventDefault();\n\t\t\ttock.timer.reset(this);\n\t\t})\n\t\t.on('click', '.btn-add-entry', function(e) {\n\t\t\t// Add a new entry to the layout\n\t\t\te.preventDefault();\n\t\t\ttock.ui.createEntry();\n\t\t\ttock.ui.saveLayout();\n\t\t})\n\t\t.on('click', '.btn-del-entry', function(e) {\n\t\t\t// Remove selected entry from the layout\n\t\t\te.preventDefault();\n\t\t\ttock.ui.deleteEntry(this);\n\t\t\ttock.ui.saveLayout();\n\t\t})\n\t\t.on('focus', 'input[type=text]', function() {\n\t\t\t// Expand the input when focused\n\t\t\t$(this).addClass('focused');\n\t\t})\n\t\t.on('blur', 'input[type=text]', function() {\n\t\t\t// Shrink the input when blurred\n\t\t\t$(this).removeClass('focused');\n\t\t\ttock.ui.saveLayout();\n\t\t})\n\t\t.on('keyup', 'input[type=text]', function(e) {\n\t\t\t// Trigger the blur event on input when enter or escape key is pressed\n\t\t\tif (e.which == 13 || e.which == 27) {\n\t\t\t\t$(this).trigger('blur');\n\t\t\t}\n\t\t})\n\t\t.on('click', '.btn-export', function(e) {\n\t\t\t// Reset the layout to default\n\t\t\te.preventDefault();\n\t\t\ttock.export.toCSV();\n\t\t})\n\t\t.on('click', '.btn-reset-layout', function(e) {\n\t\t\t// Reset the layout to default\n\t\t\te.preventDefault();\n\t\t\ttock.ui.resetLayout();\n\t\t})\n\t\t.on('click', '.btn-reset-timers', function(e) {\n\t\t\t// Reset the timers to zero but keep the layout\n\t\t\te.preventDefault();\n\t\t\ttock.ui.resetTimers();\n\t\t})\n\t;\n};\n\ntock.ui.renderLayout = function() {\n\tvar layout = tock.storage.getItem('layout');\n\n\t$(layout.entries).each(function(k, v) {\n\t\tvar $entry = tock.ui.cloneTemplate()\n\t\t\t.attr('id', v.id);\n\n\t\t$entry.find('.task input').val(v.task);\n\t\t$entry.find('.log input').val(v.log);\n\n\t\tif (v.elapsed) {\n\t\t\t$entry.data('tock-timer-elapsed', parseInt(v.elapsed));\n\t\t\ttock.ui.timerButtonSwap($entry.find('.btn-start-timer'));\n\t\t}\n\n\t\tif (v.running) {\n\t\t\t$entry.data('tock-timer-running', v.running);\n\t\t\ttock.ui.timerButtonSwap($entry.find('.btn-start-timer'));\n\t\t}\n\n\t\ttock.ui.addEntry($entry);\n\t});\n\n};\n\ntock.ui.saveLayout = function() {\n\tvar layout = {\n\t\t\"entries\": []\n\t};\n\n\t$('.entry').each(function() {\n\t\tvar $entry = $(this);\n\t\tvar e = {\n\t\t\t\"id\": $entry.attr('id'),\n\t\t\t\"task\": $entry.find('.task input').val(),\n\t\t\t\"log\": $entry.find('.log input').val(),\n\t\t\t\"running\": $entry.data('tock-timer-running'),\n\t\t\t\"elapsed\": $entry.data('tock-timer-elapsed')\n\t\t};\n\n\t\tlayout.entries.push(e);\n\t});\n\n\ttock.storage.setItem('layout', layout);\n};\n\ntock.ui.resetLayout = function() {\n\ttock.storage.initDefaultLayout();\n\ttock.ui.refresh();\n};\n\ntock.ui.resetTimers = function() {\n\t$('.btn-reset-timer').each(function() {\n\t\ttock.timer.reset(this);\n\t});\n};\n\n// Render the timer in current state\ntock.ui.updateElapsed = function() {\n\t$('.entry').each(function() {\n\t\tvar $entry = $(this),\n\t\t\tstart = $entry.data('tock-timer-start'),\n\t\t\telapsed = $entry.data('tock-timer-elapsed'),\n\t\t\t$elapsedInput = $entry.find('.elapsed .jira'),\n\t\t\tdiff = elapsed;\n\n\t\t// Update the timer every second with a new time\n\t\tif ($entry.data('tock-timer-running') === true) {\n\t\t\tif (start) { // Button was pushed and timer is ticking\n\t\t\t\telapsed = Math.ceil(Date.now() / 1000);\n\t\t\t\tdiff = Math.ceil(elapsed - start);\n\t\t\t\t$entry.data('tock-timer-elapsed', diff);\n\t\t\t}\n\t\t\telse { // Start time is not available but we have elapsed data\n\t\t\t\tstart = Math.ceil(Date.now() / 1000) - elapsed;\n\t\t\t\t$entry.data('tock-timer-start', start);\n\t\t\t}\n\n\t\t\t// Draw the new timer value\n\t\t\t$elapsedInput.val(tock.ui.formatTimeJira(diff));\n\t\t\t$entry.find('.elapsed .dp').html(tock.ui.formatTimeDP(diff));\n\t\t}\n\t\telse if (elapsed > 0 && $elapsedInput.val() === '' && !$elapsedInput.hasClass('focused')) {\n\t\t\t// Timer is not running but we have elapsed data. Maybe we just refreshed the browser while paused\n\t\t\t// Let's draw the elaped time\n\t\t\t$elapsedInput.val(tock.ui.formatTimeJira(diff));\n\t\t\t$entry.find('.elapsed .dp').html(tock.ui.formatTimeDP(diff));\n\t\t}\n\n\t\t// Disable input if timer is running\n\t\tif ($entry.data('tock-timer-running') === true) {\n\t\t\t$elapsedInput.attr('readonly', 'readonly');\n\t\t}\n\t\telse {\n\t\t\t$elapsedInput.removeAttr('readonly');\n\t\t}\n\t});\n};\n\ntock.ui.formatTimeJira = function(elapsed) {\n\tif (elapsed) {\n\t\tvar h = Math.floor(elapsed / (60 * 60)),\n\t\t\tm = Math.floor(elapsed % (60 * 60) / 60),\n\t\t\thtml = '';\n\n\t\tif (h > 0) {\n\t\t\thtml = h + 'H ';\n\t\t}\n\n\t\treturn html + m + 'm';\n\t}\n\n\treturn '0m';\n};\n\ntock.ui.formatJiraTime = function(string) {\n\tif (string) {\n\t\tvar h = string.match(/[0-9]+h/i),\n\t\t\tm = string.match(/[0-9]+m/i),\n\t\t\tts = 0;\n\n\t\tif (h && h.length) {\n\t\t\tvar hours = parseInt(h[0].replace(/h/ig));\n\t\t\tconsole.log(hours);\n\t\t\tif (hours > 0) {\n\t\t\t\tts += (60 * 60 * hours);\n\t\t\t}\n\t\t}\n\n\t\tif (m && m.length) {\n\t\t\tvar minutes = parseInt(m[0].replace(/m/ig));\n\t\t\tconsole.log(minutes);\n\t\t\tif (minutes > 0) {\n\t\t\t\tts += (60 * minutes);\n\t\t\t}\n\t\t}\n\n\t\tconsole.log(ts);\n\t\treturn ts;\n\t}\n\n\treturn 0;\n};\n\ntock.ui.formatTimeDP = function(elapsed) {\n\tif (elapsed) {\n\t\treturn (elapsed / (60 * 60)).toFixed(2);\n\t}\n\n\treturn '0.0';\n};\n\n// Change the state of the timer button\ntock.ui.timerButtonSwap = function(button) {\n\tvar $button = $(button),\n\t\t$entry = $button.parents('.entry');\n\n\tif ($entry.data('tock-timer-running')) {\n\t\tif ($button.hasClass('btn-start-timer')) {\n\t\t\ttock.ui.timerButtonSwapToRunning($button);\n\t\t}\n\t\telse {\n\t\t\ttock.ui.timerButtonSwapToStart($button);\n\t\t}\n\t}\n\telse if ($entry.data('tock-timer-elapsed')) {\n\t\ttock.ui.timerButtonSwapToPaused($button);\n\t}\n\telse {\n\t\ttock.ui.timerButtonSwapToStart($button);\n\t}\n};\n\ntock.ui.timerButtonSwapToStart = function($button) {\n\t$button.removeClass('btn-stop-timer btn-danger btn-warning')\n\t\t.addClass('btn-start-timer btn-success')\n\t\t.attr('title', 'Start this timer')\n\t\t.html('<span class=\"fa-stack\"><i class=\"fa fa-cog fa-stack-2x\"></i><i class=\"fa fa-play fa-stack-1x\"></i></span>');\n};\n\ntock.ui.timerButtonSwapToPaused = function($button) {\n\t$button.removeClass('btn-stop-timer btn-danger')\n\t\t.addClass('btn-start-timer btn-warning')\n\t\t.attr('title', 'Start this timer')\n\t\t.html('<span class=\"fa-stack\"><i class=\"fa fa-cog fa-stack-2x\"></i><i class=\"fa fa-play fa-stack-1x\"></i></span>');\n};\n\ntock.ui.timerButtonSwapToRunning = function($button) {\n\t$button.removeClass('btn-start-timer btn-success btn-warning')\n\t\t.addClass('btn-stop-timer btn-danger')\n\t\t.attr('title', 'Pause this timer')\n\t\t.html('<span class=\"fa-stack\"><i class=\"fa fa-cog fa-spin fa-stack-2x\"></i><i class=\"fa fa-pause fa-stack-1x\"></i></span>');\n};\n\ntock.ui.cloneTemplate = function() {\n\treturn tock.ui.getTemplateEntry()\n\t\t.clone()\n\t\t.removeClass('template hidden')\n\t\t.addClass('entry');\n};\n\ntock.ui.createEntry = function() {\n\ttock.ui.addEntry(tock.ui.cloneTemplate());\n};\n\ntock.ui.addEntry = function(entry) {\n\t$('.controls', 'main')\n\t\t.before(entry);\n};\n\ntock.ui.deleteEntry = function(element) {\n\tvar $entry = $(element)\n\t\t.parents('.entry');\n\t$entry.remove();\n};\n\ntock.ui.getTemplateEntry = function() {\n\treturn $('.template');\n};\n\ntock.ui.refresh = function() {\n\twindow.location = '';\n};\n"],"sourceRoot":"/source/"}